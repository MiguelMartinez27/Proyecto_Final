{% extends 'base.html' %} {% block content %}
<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Registro de Usuario</title>
  </head>
  <body>
    <h1 class="text-center">Formulario de Registro</h1>

    {% if mensaje %}
    <p>{{ mensaje }}</p>
    {% endif %}

    <form method="POST">
      {% csrf_token %} {{ form.as_p }}
      <!-- Muestra el formulario -->
      <button type="submit">Registrar</button>
    </form>

    {% if form.errors %}
    <p>Hubo algunos errores en el formulario. Por favor, revisa los campos.</p>
    {% endif %}

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script type="text/javascript">
      $("#id_region").change(function () {
        var url = "{% url 'ajax_load_comunas' %}"; // obtiene la URL para la vista de carga AJAX
        var regionId = $(this).val(); // obtiene el id de la región seleccionada
        $.ajax({
          url: url,
          data: {
            region_id: regionId,
          },
          success: function (data) {
            $("#id_comuna").html(""); // vacía las opciones existentes
            $.each(data, function (key, value) {
              $("#id_comuna").append(
                '<option value="' + value.id + '">' + value.nombre + "</option>"
              );
            });
          },
        });
      });
    </script>
  </body>
</html>
{% endblock %}
